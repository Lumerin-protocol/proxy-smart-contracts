# Futures Contract Root Entity
type Futures @entity(immutable: false) {
  "Use id=0"
  id: Int8!
  initializedBlockNumber: BigInt!
  initializeTimestamp: BigInt!

  "Contract configuration parameters"
  minimumPriceIncrement: BigInt!
  orderFee: BigInt!
  liquidationMarginPercent: Int!
  speedHps: BigInt!
  deliveryDurationDays: Int!
  deliveryIntervalDays: Int!
  futureDeliveryDatesCount: Int!
  firstFutureDeliveryDate: BigInt!
  breachPenaltyRatePerDay: BigInt!
  validatorAddress: Bytes!
  hashrateOracleAddress: Bytes!
  tokenAddress: Bytes!
  futuresAddress: Bytes!
  validatorURL: String!

  "Number of contracts including archived"
  contractCount: Int!
  "Number of not archived contracts"
  contractActiveCount: Int!

  # purchase stats
  purchaseCount: Int!
  closeoutCount: Int!
}

# Futures Contract Entities
type Participant @entity(immutable: false) {
  id: Bytes!
  address: Bytes!
  positions: [Position!]!
  orders: [Order!]!

  # Stats
  positionCount: Int!
  orderCount: Int!
  totalVolume: BigInt!

  # Balance tracking
  balance: BigInt!
  totalDeposited: BigInt!
  totalWithdrawn: BigInt!
  lastBalanceUpdate: BigInt!
}

type Order @entity(immutable: false) {
  id: Bytes!
  participant: Participant!
  pricePerDay: BigInt!
  deliveryAt: BigInt!
  isBuy: Boolean!
  timestamp: BigInt!
  blockNumber: BigInt!
  transactionHash: Bytes!
  destURL: String!

  # Status
  isActive: Boolean!
  closedAt: BigInt
  closedBy: Bytes
}

type Position @entity(immutable: false) {
  id: Bytes!
  seller: Participant!
  buyer: Participant!
  sellPricePerDay: BigInt!
  buyPricePerDay: BigInt!
  deliveryAt: BigInt!
  timestamp: BigInt!
  blockNumber: BigInt!
  transactionHash: Bytes!
  orderId: Bytes!
  destURL: String!

  # Status
  isActive: Boolean!
  closedAt: BigInt
  closedBy: Bytes
  isPaid: Boolean!
}

type HashrateOracle @entity(immutable: false) {
  id: Int8!
  initializedBlockNumber: BigInt!
  initializeTimestamp: BigInt!
}

# Delivery Date Orders - tracks buy/sell counts per price level for each delivery date
type DeliveryDateOrder @entity(immutable: false) {
  "ID format: {deliveryDate}-{price}"
  id: String!
  deliveryDate: BigInt!
  price: BigInt!
  buyOrdersCount: Int!
  sellOrdersCount: Int!
}

# HashrateOracle Timeseries Entities
type HashrateIndex @entity(timeseries: true) {
  id: Int8!
  hashesForBTC: BigInt!
  hashesForToken: BigInt!
  blockNumber: BigInt!
  timestamp: Timestamp!
}

type HashesForBTCCandle @aggregation(intervals: ["hour", "day"], source: "HashrateIndex") {
  id: Int8!

  high: BigInt! @aggregate(fn: "max", arg: "hashesForBTC")
  low: BigInt! @aggregate(fn: "min", arg: "hashesForBTC")
  sum: BigInt! @aggregate(fn: "sum", arg: "hashesForBTC")
  count: BigInt! @aggregate(fn: "count", arg: "hashesForBTC")

  timestamp: Timestamp!
}

type HashesForTokenCandle @aggregation(intervals: ["hour", "day"], source: "HashrateIndex") {
  id: Int8!

  high: BigInt! @aggregate(fn: "max", arg: "hashesForToken")
  low: BigInt! @aggregate(fn: "min", arg: "hashesForToken")
  sum: BigInt! @aggregate(fn: "sum", arg: "hashesForToken")
  count: BigInt! @aggregate(fn: "count", arg: "hashesForToken")

  timestamp: Timestamp!
}
